// Generated by CoffeeScript 1.8.0
define(['ehbs!templates/test'], function() {
  var TestRoute;
  return TestRoute = {
    bind: function(App) {
      App.Router.map(function() {
        return this.route('test', {
          path: '/test/:name'
        });
      });
      App.TestRoute = Ember.Route.extend({
        model: function(params) {
          return {
            bot: params.name
          };
        }
      });
      return App.TestController = Ember.ObjectController.extend({
        conversation: '',
        actions: {
          talk: function(input) {
            var bot, thiz, uid;
            thiz = this;
            uid = this.get('uid');
            bot = this.get('bot');
            $.ajax({
              url: '/bot/talk',
              type: 'POST',
              data: JSON.stringify({
                bot: bot,
                uid: uid,
                query: input
              }),
              dataType: 'json',
              contentType: 'application/json; charset=utf-8'
            }).done(function(result) {
              var message;
              message = '[Bot|' + bot + '] ' + result.text;
              return thiz.send('update', message);
            }).fail(function(response) {
              return alert(response.responseText);
            }).always(function() {
              return thiz.set('input', '');
            });
            return false;
          },
          update: function(msg) {
            var conv;
            conv = this.get('conversation');
            conv += msg + '\r\n';
            this.set('conversation', conv);
            setTimeout(function() {
              return $('textarea').scrollTop($('textarea')[0].scrollHeight);
            }, 300);
            return false;
          }
        }
      });
    }
  };
});
