// Generated by CoffeeScript 1.8.0
define(['routes/testRoute', 'routes/editRoute', 'routes/IDERoute', 'ehbs!templates/index'], function(TestRoute, EditRoute, IDERoute) {
  var app;
  return app = {
    start: function() {
      var App;
      App = Ember.Application.create();
      App.Router.map(function() {
        this.route('test');
        this.route('edit');
        return this.route('IDE');
      });
      TestRoute.bind(App);
      EditRoute.bind(App);
      IDERoute.bind(App);
      App.IndexRoute = Ember.Route.extend({
        model: function() {
          return new Ember.RSVP.Promise(function(resolve, reject) {
            return new Ember.RSVP.hash({
              bots: Ember.$.getJSON('/bot/bots')
            }).then(function(result) {
              return resolve({
                question: null,
                uid: 'TEST-USER-001',
                display: '',
                bots: result.bots
              });
            }, function(errors) {
              return reject(errors);
            });
          });
        }
      });
      return App.IndexController = Ember.ObjectController.extend({
        actions: {
          update: function(message) {
            var display;
            display = this.get('display');
            display += message + '\r\n';
            this.set('display', display);
            return setTimeout(function() {
              return $('textarea').scrollTop($('textarea')[0].scrollHeight);
            }, 300);
          },
          talk: function() {
            var bot, message, question, thiz, uid;
            thiz = this;
            bot = this.get('bot');
            uid = this.get('uid');
            question = this.get('question');
            $.ajax({
              url: '/bot/talk',
              type: 'POST',
              data: JSON.stringify({
                bot: bot,
                uid: uid,
                query: question
              }),
              dataType: 'json',
              contentType: 'application/json; charset=utf-8'
            }).done(function(result) {
              var message;
              message = '[BOT] ' + result.text;
              return thiz.send('update', message);
            }).fail(function(response) {
              return thiz.send('update', '[SYSTEM] ' + response.responseText);
            });
            thiz.set('question', null);
            message = '[HUMAN] ' + question;
            this.send('update', message);
            return false;
          },
          compile: function() {
            var bot, thiz;
            thiz = this;
            bot = this.get('bot');
            $.ajax({
              url: '/bot/compile',
              type: 'POST',
              data: JSON.stringify({
                bot: bot
              }),
              dataType: 'json',
              contentType: 'application/json; charset=utf-8'
            }).done(function(result) {
              return thiz.send('update', '[SYSTEM] Grammar compilation done for bot ' + bot);
            }).fail(function(response) {
              return thiz.send('update', '[SYSTEM] Grammar compilation failed for bot ' + bot + ' ' + response.responseText);
            });
            return false;
          },
          reload: function() {
            var bot, thiz;
            thiz = this;
            bot = this.get('bot');
            $.ajax({
              url: '/bot/reload',
              type: 'POST',
              data: JSON.stringify({
                bot: bot
              }),
              dataType: 'json',
              contentType: 'application/json; charset=utf-8'
            }).done(function(result) {
              thiz.send('update', '[SYSTEM] Bot reloaded successfully for ' + bot);
              return true;
            }).fail(function(response) {
              return false;
            });
            return false;
          }
        }
      });
    }
  };
});
